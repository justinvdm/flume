!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.flume=n.flume||{})}(this,function(n){"use strict";function e(n,e){return e={exports:{}},n(e,e.exports),e.exports}function t(n){return function(e,t){return[null,n(t)]}}function r(n,e){function t(n,t){var r=e(n,t);return[r,r]}return{init:n,process:t}}function u(n){return n}function i(n){return n=n||u,function(e,t){return[null,x([n(t),t]).then(o)]}}function o(n){return n[0]?n[1]:m}function f(n,e){function t(n,t){return[n,e(n,t)]}return{init:n,process:t}}function c(){return""}function s(n){function e(e,t){var r=(e+t).split(n);return[r.slice(-1),r.slice(0,-1)]}return{init:c,process:e}}var l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=e(function(n,e){!function(n,t){"function"==typeof n.define&&n.define.amd?n.define(t):"object"==typeof e?t(!0):n.flume=t()}(l,function(e){function t(){return new c}function r(n){function e(n,e,r){var u=g(t.inputs,n),i=u.length,o=-1;for(r=_(i,r||x);++o<i;)u[o].handle(e,r);return t}var t={};return t.dispatch=e,t.inputs=a(t,n),t}function u(n,e){return new f(n,e)}function i(n){return o({"flume:error":n})}function o(n){return{process:w({"*":d},n)}}function f(n,e){this.type=n,this.value=e}function c(){this.defType="input"}function s(n){this.defType="processor",this.init=b(n.init,x),this.process=n.process}function l(n,e,t,r){this.graph=n,this.def=e,this.child=t,this.index=r,this.handle=y(this)}function a(n,e,t,r){var u=e.length-1;if(u<0)return[];for(u&&(t=new l(n,h(e[u]),t,r));--u>0;)t=new l(n,h(e[u]),t,0);return p(n,e[0],t)}function p(n,e,t){e=q(e);for(var r,u=[],i=-1,o=e.length;++i<o;)if(r=e[i],Array.isArray(r))u.push.apply(u,a(n,r,t,i));else{if(!(r instanceof c))throw Error("Expected input or array but got "+S(r));u.push(new l(n,r,t,i))}return u}function h(n){if("function"==typeof n)n={process:{"flume:value":n}};else if("function"==typeof(n||0).process)n=w(n,{process:{"flume:value":n.process}});else if("object"!==S((n||0).process))throw Error("Expected function or object matching processor shape but got "+S(n));return new s(n)}function d(n,e){return[e]}function y(n){return{input:v,processor:m}[n.def.defType](n)}function v(n){return function(e,t){n.child.handle(e,n,t)}}function m(n){function e(n){s.push(n),l||t()}function t(){a=s.shift(),a&&r()}function r(){return l=!0,h().then(k).then(f,c)}function i(){var e=n.def.process,t=e[a.msg.type]||e["*"];return t?t(p,a.msg.value,a.parent.def,n.graph):[p,a.msg]}function o(e){var r=a.end;l=!1,a=null,n.child?n.child.handle(e,n,r):r(),t()}function f(n){var e;Array.isArray(n)?(p=n[0],e=n.length>1?n[1]:p):e=D,o(e)}function c(e){if(!n.child)throw new B(e);o(u("flume:error",e))}var s=[],l=!1,a=null,p=n.def.init(),h=T(i);return function(n,t,r){n=q(n).map(E);for(var u=-1,i=n.length-1;++u<i;)e({msg:n[u],parent:t,end:x});i>-1&&e({msg:n[i],parent:t,end:r})}}function g(n,e){for(var t,r=[],u=n.length,i=-1;++i<u;)t=n[i],t.def===e&&r.push(t);return r}function w(){for(var n,e={},t=Array.prototype.slice.call(arguments),r=-1,u=t.length;++r<u;){n=t[r];for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}function x(){return null}function b(n,e){return void 0===n?e:n}function A(n){return n}function j(n){throw n}function E(n){return n instanceof f?n:u("flume:value",n)}function q(n){return Array.isArray(n)?n:[n]}function S(n){return null!==n?typeof n:"null"}function _(n,e){var t=0;return function(){++t>=n&&e.apply(null,arguments)}}function T(n){return function(){try{var e=n.apply(this,arguments);return F(e)}catch(t){if(t instanceof B)throw t.error;return P(t)}}}function F(n){return z(n)?n:O(n)}function O(n){return new C(n,(!1))}function P(n){return new C(n,(!0))}function k(n){return Array.isArray(n)&&n.filter(z).length>0?M(n):F(n)}function M(n){function e(){return F(n[++f]).then(t)}function t(n){u.push(n)}function r(){return u}for(var u=[],i=n.length,o=-1,f=-1,c=O(null);++o<i;)c=c.then(e);return c.then(r)}function z(n){return!!(n||0).then}function B(n){this.error=n}function C(n,e){this.value=n,this.isFailure=e}var D=u("flume:nil",null);return C.prototype.then=T(function(n,e){return this.isFailure?(e||j).call(this,this.value):(n||A).call(this,this.value)}),e?void(n.exports={create:r,input:t,message:u,trap:o,except:i,nil:D,conj:w,maybeAsync:T,resolveSeq:k}):{create:r,input:t,message:u,trap:o,except:i,nil:D,conj:w,maybeAsync:T,resolveSeq:k}})}),p=a.create,h=a.input,d=a.message,y=a.trap,v=a.except,m=a.nil,g=a.conj,w=a.maybeAsync,x=a.resolveSeq;n.map=t,n.reduce=r,n.filter=i,n.sink=f,n.strsplit=s,n.__moduleExports=a,n.create=p,n.input=h,n.message=d,n.trap=y,n.except=v,n.nil=m,n.conj=g,n.maybeAsync=w,n.resolveSeq=x,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=flume.min.js.map
